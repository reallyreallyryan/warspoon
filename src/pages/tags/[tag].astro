---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import TagFilter from '../../components/TagFilter.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('workshop', ({ data }) => !data.draft);
  const allTags = [...new Set(posts.flatMap((p) => p.data.tags))].sort();

  return allTags.map((tag) => ({
    params: { tag },
    props: {
      tag,
      posts: posts
        .filter((p) => p.data.tags.includes(tag))
        .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf()),
      allTags,
    },
  }));
}

const { tag, posts, allTags } = Astro.props;
---

<BaseLayout title={`${tag.charAt(0).toUpperCase() + tag.slice(1)} Posts`} description={`Warspoon workshop posts tagged with ${tag} â€” painting tutorials, showcases, and hobby projects.`}>
  <h1 class="text-3xl font-bold mb-6">
    Tag: <span class="text-(--color-accent)">{tag}</span>
  </h1>
  <TagFilter tags={allTags} activeTag={tag} />
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {posts.map((post) => (
      <PostCard
        id={post.id}
        title={post.data.title}
        description={post.data.description}
        date={post.data.date}
        tags={post.data.tags}
        cover={post.data.cover}
        coverAlt={post.data.coverAlt}
      />
    ))}
  </div>
</BaseLayout>
