---
const ga4Id = import.meta.env.PUBLIC_GA4_ID;
const clarityId = import.meta.env.PUBLIC_CLARITY_ID;
---

{ga4Id && (
  <script is:inline async src={`https://www.googletagmanager.com/gtag/js?id=${ga4Id}`}></script>
  <script is:inline define:vars={{ ga4Id }}>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', ga4Id, { send_page_view: false });

    // Re-fire pageview on Astro view transitions (SPA navigation)
    document.addEventListener('astro:page-load', () => {
      gtag('event', 'page_view', {
        page_location: window.location.href,
        page_title: document.title,
      });
    });
  </script>
)}

{clarityId && (
  <script is:inline define:vars={{ clarityId }}>
    (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window,document,"clarity","script",clarityId);
  </script>
)}
