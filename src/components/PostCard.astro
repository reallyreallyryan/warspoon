---
import { Image } from 'astro:assets';
import FormattedDate from './FormattedDate.astro';
import TagPill from './TagPill.astro';
import type { ImageMetadata } from 'astro';

interface Props {
  id: string;
  title: string;
  description: string;
  date: Date;
  tags: string[];
  cover?: ImageMetadata;
  coverAlt?: string;
  coverPosition?: 'top' | 'center' | 'bottom';
}

const { id, title, description, date, tags, cover, coverAlt, coverPosition = 'center' } = Astro.props;
const positionClass = { top: 'object-top', center: 'object-center', bottom: 'object-bottom' }[coverPosition];
---

<article class="group rounded-lg border border-(--color-surface-700) bg-(--color-surface-800) overflow-hidden transition-colors hover:border-(--color-accent)">
  <a href={`/workshop/${id}/`} class="block">
    {cover ? (
      <Image
        src={cover}
        alt={coverAlt ?? ''}
        widths={[400, 600]}
        sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
        class={`w-full aspect-video object-cover ${positionClass}`}
        loading="lazy"
      />
    ) : (
      <div class="w-full aspect-video bg-(--color-surface-700) flex items-center justify-center text-(--color-text-secondary) text-sm">
        No image yet
      </div>
    )}
  </a>
  <div class="p-4">
    <div class="text-xs text-(--color-text-secondary) mb-2">
      <FormattedDate date={date} />
    </div>
    <a href={`/workshop/${id}/`} class="block">
      <h2 class="text-lg font-semibold mb-2 group-hover:text-(--color-accent) transition-colors">
        {title}
      </h2>
    </a>
    <p class="text-sm text-(--color-text-secondary) mb-3 line-clamp-2">{description}</p>
    <div class="flex flex-wrap gap-2">
      {tags.map((tag) => <TagPill tag={tag} />)}
    </div>
  </div>
</article>
